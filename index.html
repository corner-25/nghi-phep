<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no, date=no, email=no, url=no">
    <title>H·ªá th·ªëng Qu·∫£n l√Ω Ngh·ªâ ph√©p - Firebase</title>
    <script>
      (function(){
        var DEBUG = false; // set true if you want to re-enable console logs
        if (!DEBUG) {
          var noop = function(){};
          var c = window.console = window.console || {};
          [
            'log','info','debug','warn','error','trace','group','groupCollapsed','groupEnd','table','time','timeEnd','timeLog','dir'
          ].forEach(function(k){
            try { c[k] = noop; } catch(e) {}
          });
        }
        window.__DEBUG__ = DEBUG;
      })();
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f3f4f6;
            color: #374151;
            line-height: 1.6;
        }

        html, body {
            max-width: 100%;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            height: 100%;
        }

        img, canvas, svg, video {
            max-width: 100%;
            height: auto;
            display: block;
        }

        /* Larger tap targets */
        .btn { min-height: 44px; }
        .input, select, textarea { min-height: 44px; }
        .radio-item input[type="radio"] { width: 18px; height: 18px; }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        .container-sm {
            max-width: 640px;
            margin: 0 auto;
            padding: 24px;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 24px;
            word-break: break-word;
        }

        .card:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.2s;
        }

        .grid {
            display: grid;
            gap: 24px;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
        }

        .flex {
            display: flex;
            align-items: center;
        }

        .flex-col {
            flex-direction: column;
        }

        .flex-between {
            justify-content: space-between;
        }

        .flex-center {
            justify-content: center;
        }

        .flex-1 {
            flex: 1;
        }

        .text-center {
            text-align: center;
        }

        .text-sm {
            font-size: 14px;
        }

        .text-xs {
            font-size: 12px;
        }

        .text-lg {
            font-size: 18px;
        }

        .text-xl {
            font-size: 20px;
        }

        .text-2xl {
            font-size: 24px;
        }

        .text-3xl {
            font-size: 30px;
        }

        .font-medium {
            font-weight: 500;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-bold {
            font-weight: 700;
        }

        .mb-2 { margin-bottom: 8px; }
        .mb-4 { margin-bottom: 16px; }
        .mb-6 { margin-bottom: 24px; }
        .mb-8 { margin-bottom: 32px; }
        .mt-2 { margin-top: 8px; }
        .mt-4 { margin-top: 16px; }
        .mt-8 { margin-top: 32px; }
        .ml-2 { margin-left: 8px; }
        .mr-2 { margin-right: 8px; }
        .mr-3 { margin-right: 12px; }
        .ml-4 { margin-left: 16px; }

        .p-3 { padding: 12px; }
        .p-4 { padding: 16px; }
        .p-6 { padding: 24px; }
        .py-2 { padding-top: 8px; padding-bottom: 8px; }
        .px-2 { padding-left: 8px; padding-right: 8px; }
        .px-3 { padding-left: 12px; padding-right: 12px; }
        .px-4 { padding-left: 16px; padding-right: 16px; }
        .pt-4 { padding-top: 16px; }

        .w-full {
            width: 100%;
        }

        .h-4 { height: 16px; width: 16px; }
        .h-5 { height: 20px; width: 20px; }
        .h-6 { height: 24px; width: 24px; }
        .h-8 { height: 32px; width: 32px; }
        .h-12 { height: 48px; width: 48px; }

        /* Icon alignment helper to keep symbols perfectly centered next to headings */
        .icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            font-size: 20px; /* match .text-xl heading size */
            line-height: 1;
            flex: 0 0 auto;
        }

        /* Brand header with logo + title */
        .header-brand {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 8px; /* replaces h1 mb-2 spacing */
        }
        .header-brand h1 { margin: 0; }
        .brand-logo {
            width: 36px;
            height: 36px;
            object-fit: contain;
            flex: 0 0 auto;
        }
        @media (max-width: 768px) {
            .brand-logo { width: 28px; height: 28px; }
        }

        /* Normalize icon size inside buttons for perfect vertical alignment */
        .btn .icon {
            width: 20px;
            height: 20px;
            font-size: 16px;
            line-height: 1;
        }

        /* Button polish */
        .btn:active { transform: translateY(1px); }
        .btn:focus-visible { outline: 2px solid rgba(59,130,246,0.6); outline-offset: 2px; }
        .btn-primary, .btn-success, .btn-secondary, .btn-danger { box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .btn-primary:hover:not(:disabled),
        .btn-success:hover:not(:disabled),
        .btn-secondary:hover:not(:disabled),
        .btn-danger:hover:not(:disabled) { box-shadow: 0 2px 6px rgba(0,0,0,0.10); }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            font-size: 14px;
            touch-action: manipulation;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #2563eb;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #dc2626;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #4b5563;
        }

        .input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .input:disabled {
            background: #f9fafb;
            opacity: 0.5;
        }

        .label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .radio-item {
            display: flex;
            align-items: center;
        }

        .radio-item input[type="radio"] {
            margin-right: 8px;
        }

        .text-gray-500 { color: #6b7280; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-800 { color: #1f2937; }
        .text-blue-500 { color: #3b82f6; }
        .text-blue-600 { color: #2563eb; }
        .text-green-500 { color: #10b981; }
        .text-green-800 { color: #065f46; }
        .text-red-500 { color: #ef4444; }
        .text-red-800 { color: #991b1b; }
        .text-orange-500 { color: #f59e0b; }
        .text-orange-600 { color: #d97706; }

        .bg-gray-50 { background: #f9fafb; }
        .bg-gray-100 { background: #f3f4f6; }
        .bg-green-100 { background: #dcfce7; }
        .bg-red-100 { background: #fee2e2; }

        .border {
            border: 1px solid #d1d5db;
        }

        .rounded {
            border-radius: 4px;
        }

        .rounded-lg {
            border-radius: 8px;
        }

        .space-y-2 > * + * {
            margin-top: 8px;
        }

        .space-y-4 > * + * {
            margin-top: 16px;
        }

        .space-x-2 > * + * {
            margin-left: 8px;
        }

        .space-x-4 > * + * {
            margin-left: 16px;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: white;
            border-radius: 12px;
            padding: 24px;
            width: 320px;
            max-width: 90vw;
        }

        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 16px;
            right: 16px;
            padding: 16px;
            border-radius: 8px;
            color: white;
            z-index: 1001;
            font-weight: 500;
        }

        .notification.success {
            background: #10b981;
        }

        .notification.error {
            background: #ef4444;
        }

        .hidden { display: none; }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge.success {
            background: #dcfce7;
            color: #065f46;
        }

        .badge.danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .stat-card {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: #6b7280;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-summary {
            background: #f9fafb;
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
        }

        .empty-state {
            text-align: center;
            padding: 32px;
            color: #6b7280;
        }

        .connection-status {
            position: fixed;
            top: calc(10px + env(safe-area-inset-top));
            left: calc(10px + env(safe-area-inset-left));
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            z-index: 1002;
        }

        .connection-status.connected {
            background: #dcfce7;
            color: #065f46;
        }

        .connection-status.disconnected {
            background: #fee2e2;
            color: #991b1b;
        }

        .connection-status.connecting {
            background: #fef3c7;
            color: #92400e;
        }

        @media (max-width: 768px) {
            .container, .container-sm {
                padding: 16px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .flex-mobile {
                flex-direction: column;
                gap: 8px;
            }
        }

        /* --- Mobile enhancements --- */
        @media (max-width: 768px) {
          .container, .container-sm { padding: 12px; }
          .card { padding: 16px; margin-bottom: 16px; border-radius: 10px; }
          .text-3xl { font-size: 24px; }
          .text-2xl { font-size: 20px; }
          .text-xl { font-size: 18px; }
          .btn { width: 100%; padding: 12px 16px; font-size: 16px; }
          .input { font-size: 16px; padding: 10px 12px; }
          .grid-4 { grid-template-columns: repeat(2, 1fr); gap: 12px; }
          .mobile-sticky-actions { position: sticky; bottom: 0; background: white; padding-top: 12px; margin-top: 8px; box-shadow: 0 -4px 12px rgba(0,0,0,0.05); padding-bottom: calc(12px + env(safe-area-inset-bottom)); left: 0; right: 0; }
          .mobile-stack { flex-direction: column; gap: 8px; }
          .mobile-stack > .btn { width: 100%; }
        }

        @media (max-width: 480px) {
          .text-3xl { font-size: 22px; }
          .text-2xl { font-size: 18px; }
          .text-xl { font-size: 16px; }
          .modal { width: 92vw; }
        }
    </style>
</head>
<body>
    <div id="connection-status" class="connection-status connecting">üîÑ ƒêang k·∫øt n·ªëi Firebase...</div>
    <div id="app"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        // üî• Firebase Configuration - THAY ƒê·ªîI CONFIG N√ÄY
        const firebaseConfig = {
            apiKey: "AIzaSyCIRTwceNpLY6qFl0JgRGFfTswzsItVY2E",
            authDomain: "leave-management-e2c7c.firebaseapp.com",
            projectId: "leave-management-e2c7c",
            storageBucket: "leave-management-e2c7c.firebasestorage.app",
            messagingSenderId: "556710671144",
            appId: "1:556710671144:web:e206d4028c5906dd03561d",
            measurementId: "G-SB2L4CPNZC"
        };

        // Initialize Firebase
        let db = null;
        let isFirebaseReady = false;

        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            isFirebaseReady = true;
            // Update connection status
            document.getElementById('connection-status').className = 'connection-status connected';
            document.getElementById('connection-status').innerHTML = '‚úÖ Firebase ƒë√£ k·∫øt n·ªëi';
            
            // Hide status after 3 seconds
            setTimeout(() => {
                document.getElementById('connection-status').style.display = 'none';
            }, 3000);
        } catch (error) {
            document.getElementById('connection-status').className = 'connection-status disconnected';
            document.getElementById('connection-status').innerHTML = '‚ùå L·ªói k·∫øt n·ªëi Firebase';
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Real Firebase Service
        const firebaseService = {
            // Test Firebase connection
            testConnection: async () => {
                if (!isFirebaseReady) {
                    throw new Error('Firebase ch∆∞a ƒë∆∞·ª£c kh·ªüi t·∫°o. Vui l√≤ng c·∫≠p nh·∫≠t firebaseConfig.');
                }
                return true;
            },

            // Get departments
            getDepartments: async () => {
                if (!isFirebaseReady) return [];
                try {
                    const snapshot = await db.collection('departments').orderBy('name').get();
                    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                } catch (error) {
                    throw new Error('Kh√¥ng th·ªÉ t·∫£i danh s√°ch ph√≤ng ban: ' + error.message);
                }
            },

            // Get employees
            getEmployees: async () => {
                if (!isFirebaseReady) return [];
                try {
                    const snapshot = await db.collection('employees').orderBy('name').get();
                    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                } catch (error) {
                    throw new Error('Kh√¥ng th·ªÉ t·∫£i danh s√°ch nh√¢n vi√™n: ' + error.message);
                }
            },

            // Get leave requests
            getLeaveRequests: async () => {
                if (!isFirebaseReady) return [];
                try {
                    const snapshot = await db.collection('leaveRequests')
                        .orderBy('requestDate', 'desc')
                        .limit(100)
                        .get();
                    return snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data(),
                        // Convert Firestore Timestamp to ISO string
                        requestDate: doc.data().requestDate?.toDate?.()?.toISOString() || doc.data().requestDate,
                        approvedDate: doc.data().approvedDate?.toDate?.()?.toISOString() || doc.data().approvedDate
                    }));
                } catch (error) {
                    throw new Error('Kh√¥ng th·ªÉ t·∫£i danh s√°ch ƒë∆°n ngh·ªâ ph√©p: ' + error.message);
                }
            },

            // Create leave request
            createLeaveRequest: async (data) => {
                if (!isFirebaseReady) throw new Error('Firebase ch∆∞a s·∫µn s√†ng');
                try {
                    const docRef = await db.collection('leaveRequests').add({
                        ...data,
                        requestDate: firebase.firestore.FieldValue.serverTimestamp(),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    return { id: docRef.id, ...data };
                } catch (error) {
                    throw new Error('Kh√¥ng th·ªÉ t·∫°o ƒë∆°n ngh·ªâ ph√©p: ' + error.message);
                }
            },

            // Update leave request status
            updateLeaveRequestStatus: async (id, status) => {
                if (!isFirebaseReady) throw new Error('Firebase ch∆∞a s·∫µn s√†ng');
                try {
                    await db.collection('leaveRequests').doc(id).update({
                        status: status,
                        approvedDate: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (error) {
                    throw new Error('Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i: ' + error.message);
                }
            },

            // Initialize sample data (ch·ªâ ch·∫°y 1 l·∫ßn)
            initializeData: async () => {
                if (!isFirebaseReady) return;
                
                try {
                    // Check if departments exist
                    const deptSnapshot = await db.collection('departments').limit(1).get();
                    if (!deptSnapshot.empty) {
                        return;
                    }

                    // Create departments
                    const departments = [
                        { name: 'T·ªï K·ªπ thu·∫≠t' },
                        { name: 'T·ªï Kinh doanh' },
                        { name: 'T·ªï H√†nh ch√≠nh' },
                        { name: 'T·ªï K·∫ø to√°n' }
                    ];

                    const deptRefs = [];
                    for (const dept of departments) {
                        const docRef = await db.collection('departments').add({
                            ...dept,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        deptRefs.push(docRef.id);
                    }

                    // Create employees
                    const employees = [
                        { name: 'Nguy·ªÖn VƒÉn A', departmentId: deptRefs[0] },
                        { name: 'Tr·∫ßn Th·ªã B', departmentId: deptRefs[0] },
                        { name: 'L√™ VƒÉn C', departmentId: deptRefs[1] },
                        { name: 'Ph·∫°m Th·ªã D', departmentId: deptRefs[1] },
                        { name: 'Ho√†ng VƒÉn E', departmentId: deptRefs[2] },
                        { name: 'V√µ Th·ªã F', departmentId: deptRefs[2] },
                        { name: 'ƒê·∫∑ng VƒÉn G', departmentId: deptRefs[3] },
                        { name: 'B√πi Th·ªã H', departmentId: deptRefs[3] }
                    ];

                    for (const emp of employees) {
                        await db.collection('employees').add({
                            ...emp,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }

                } catch (error) {
                    // Don't throw error here, app should still work
                }
            },

            // Get real-time updates for leave requests
            subscribeToLeaveRequests: (callback) => {
                if (!isFirebaseReady) return () => {};
                
                return db.collection('leaveRequests')
                    .orderBy('requestDate', 'desc')
                    .limit(100)
                    .onSnapshot(
                        (snapshot) => {
                            const requests = snapshot.docs.map(doc => ({
                                id: doc.id,
                                ...doc.data(),
                                requestDate: doc.data().requestDate?.toDate?.()?.toISOString() || doc.data().requestDate,
                                approvedDate: doc.data().approvedDate?.toDate?.()?.toISOString() || doc.data().approvedDate
                            }));
                            callback(requests);
                        },
                        (error) => {}
                    );
            }
        };

        const reasonOptions = [
            { value: 'cong-tac', label: 'C√¥ng t√°c' },
            { value: 'gia-dinh', label: 'Vi·ªác gia ƒë√¨nh' },
            { value: 'ca-nhan', label: 'Vi·ªác c√° nh√¢n' },
            { value: 'benh-tat', label: '·ªêm ƒëau, b·ªánh t·∫≠t' },
            { value: 'khac', label: 'Kh√°c' }
        ];

        const leaveTypeOptions = [
            { value: 'full-day', label: 'C·∫£ ng√†y' },
            { value: 'morning', label: 'N·ª≠a bu·ªïi s√°ng' },
            { value: 'afternoon', label: 'N·ª≠a bu·ªïi chi·ªÅu' }
        ];

        const startDayTypeOptions = [
            { value: 'full-day', label: 'C·∫£ ng√†y ƒë·∫ßu' },
            { value: 'morning', label: 'T·ª´ bu·ªïi s√°ng' },
            { value: 'afternoon', label: 'T·ª´ bu·ªïi chi·ªÅu' }
        ];

        const endDayTypeOptions = [
            { value: 'full-day', label: 'C·∫£ ng√†y cu·ªëi' },
            { value: 'morning', label: 'ƒê·∫øn h·∫øt bu·ªïi s√°ng' },
            { value: 'afternoon', label: 'ƒê·∫øn h·∫øt bu·ªïi chi·ªÅu' }
        ];
        
        const locationOptions = [
            { value: 'trong-tp', label: 'Trong TP. H·ªì Ch√≠ Minh' },
            { value: 'ngoai-thanh', label: 'Ngo·∫°i th√†nh' }
        ];
        
        const getLocationLabel = (location) => {
            return locationOptions.find(l => l.value === location)?.label || location;
        };
                


        const LeaveManagementApp = () => {
            const [currentPage, setCurrentPage] = useState('home');
            const [departments, setDepartments] = useState([]);
            const [employees, setEmployees] = useState([]);
            const [leaveRequests, setLeaveRequests] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showPasswordPrompt, setShowPasswordPrompt] = useState(false);
            const [firebaseError, setFirebaseError] = useState(null);
            const [realtimeEnabled, setRealtimeEnabled] = useState(false);
            const [selectedRequest, setSelectedRequest] = useState(null);
            const [showRequestDetail, setShowRequestDetail] = useState(false);
            
            const [formData, setFormData] = useState({
                departmentId: '',
                employeeId: '',
                fromDate: '',
                toDate: '',
                leaveType: 'full-day',
                startDayType: 'full-day',
                endDayType: 'full-day',
                reason: '',
                customReason: '',
                location: 'trong-tp' // Th√™m d√≤ng n√†y
            });

            useEffect(() => {
                loadData();
            }, []);

            // Setup real-time listener
            useEffect(() => {
                if (!isFirebaseReady || !realtimeEnabled) return;

                const unsubscribe = firebaseService.subscribeToLeaveRequests((requests) => {
                    setLeaveRequests(requests);
                });

                return unsubscribe;
            }, [realtimeEnabled]);

            const loadData = async () => {
                try {
                    setLoading(true);
                    setFirebaseError(null);
                    
                    // Test Firebase connection
                    await firebaseService.testConnection();
                    
                    // Initialize sample data if needed
                    await firebaseService.initializeData();
                    
                    // Load all data
                    const [deptData, empData, requestData] = await Promise.all([
                        firebaseService.getDepartments(),
                        firebaseService.getEmployees(),
                        firebaseService.getLeaveRequests()
                    ]);
                    
                    setDepartments(deptData);
                    setEmployees(empData);
                    setLeaveRequests(requestData);
                    setRealtimeEnabled(true);
                    
                } catch (error) {
                    setFirebaseError(error.message);
                    showNotification('L·ªói t·∫£i d·ªØ li·ªáu: ' + error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const showNotification = (message, type = 'success') => {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 4000);
            };
            
            const RequestDetailModal = ({ request, onClose, onApproval, loading }) => {
                if (!request) return null;

                return (
                    <div className="modal-overlay">
                        <div className="modal" style={{ width: '400px', maxWidth: '95vw' }}>
                            <div className="flex flex-between mb-4">
                                <h3 className="text-lg font-semibold">Chi ti·∫øt ƒë∆°n ngh·ªâ ph√©p</h3>
                                <button 
                                    onClick={onClose}
                                    className="btn btn-secondary"
                                    style={{ padding: '4px 8px', minHeight: 'auto' }}
                                >
                                    ‚úï
                                </button>
                            </div>
                            
                            <div className="space-y-3 text-sm">
                                <div>
                                    <span className="font-medium">Nh√¢n vi√™n:</span> {request.employeeName}
                                </div>
                                <div>
                                    <span className="font-medium">Ph√≤ng ban:</span> {request.departmentName}
                                </div>
                                <div>
                                    <span className="font-medium">Th·ªùi gian ngh·ªâ:</span><br/>
                                    {formatDateRange(request.fromDate, request.toDate, request.leaveType, request.startDayType, request.endDayType, request.leaveDays)}
                                </div>
                                <div>
                                    <span className="font-medium">S·ªë ng√†y ngh·ªâ:</span> {request.leaveDays} ng√†y
                                </div>
                                <div>
                                    <span className="font-medium">L√Ω do:</span> {getReasonLabel(request.reason, request.customReason)}
                                </div>
                                {request.location && (
                                    <div>
                                        <span className="font-medium">ƒê·ªãa ƒëi·ªÉm:</span> {getLocationLabel(request.location)}
                                    </div>
                                )}
                                <div>
                                    <span className="font-medium">Tr·∫°ng th√°i:</span>
                                    <span className={`badge ml-2 ${
                                        request.status === 'approved' ? 'success' : 
                                        request.status === 'rejected' ? 'danger' : ''
                                    }`} style={{
                                        backgroundColor: request.status === 'pending' ? '#fef3c7' : undefined,
                                        color: request.status === 'pending' ? '#92400e' : undefined
                                    }}>
                                        {request.status === 'approved' ? 'ƒê√£ duy·ªát' : 
                                        request.status === 'rejected' ? 'ƒê√£ t·ª´ ch·ªëi' : 'Ch·ªù duy·ªát'}
                                    </span>
                                </div>
                                <div>
                                    <span className="font-medium">Ng√†y ƒëƒÉng k√Ω:</span> {formatDate(request.requestDate)}
                                </div>
                                {request.approvedDate && (
                                    <div>
                                        <span className="font-medium">Ng√†y x·ª≠ l√Ω:</span> {formatDate(request.approvedDate)}
                                    </div>
                                )}
                            </div>

                            {request.status === 'pending' && onApproval && (
                                <div className="flex space-x-2 mt-6">
                                    <button
                                        onClick={() => onApproval(request.id, 'approved')}
                                        className="btn btn-success flex-1"
                                        disabled={loading}
                                    >
                                        Duy·ªát
                                    </button>
                                    <button
                                        onClick={() => onApproval(request.id, 'rejected')}
                                        className="btn btn-danger flex-1"
                                        disabled={loading}
                                    >
                                        T·ª´ ch·ªëi
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            const calculateLeaveDays = (fromDate, toDate, leaveType, startDayType, endDayType) => {
                // Normalize inputs and guard
                const start = new Date(fromDate);
                const end = new Date(toDate);
                if (isNaN(start) || isNaN(end)) return 0;
                start.setHours(0, 0, 0, 0);
                end.setHours(0, 0, 0, 0);

                const isSunday = (d) => d.getDay() === 0; // 0 = Sunday

                if (start.getTime() > end.getTime()) return 0;

                // Single-day request
                if (start.getTime() === end.getTime()) {
                    if (isSunday(start)) return 0; // Sunday does not count
                    if (leaveType === 'morning' || leaveType === 'afternoon') return 0.5;
                    return 1;
                }

                // Multi-day request: count only non-Sunday days (inclusive)
                let workingDays = 0;
                for (let d = new Date(start); d.getTime() <= end.getTime(); d.setDate(d.getDate() + 1)) {
                    if (!isSunday(d)) {
                        workingDays += 1;
                    }
                }

                // Apply half-day adjustments only if that boundary day is not Sunday
                if (!isSunday(start) && startDayType === 'afternoon') {
                    workingDays -= 0.5;
                }
                if (!isSunday(end) && endDayType === 'morning') {
                    workingDays -= 0.5;
                }

                // Ensure non-negative
                return Math.max(0, workingDays);
            };

            const handleFormSubmit = async () => {
                try {
                    if (!formData.departmentId || !formData.employeeId || !formData.fromDate || !formData.reason) {
                        showNotification('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin', 'error');
                        return;
                    }

                    if (formData.reason === 'khac' && !formData.customReason.trim()) {
                        showNotification('Vui l√≤ng nh·∫≠p l√Ω do c·ª• th·ªÉ', 'error');
                        return;
                    }

                    const toDate = formData.toDate || formData.fromDate;
                    const fromDateObj = new Date(formData.fromDate);
                    const toDateObj = new Date(toDate);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    
                    if (fromDateObj < today) {
                        showNotification('Kh√¥ng th·ªÉ ƒëƒÉng k√Ω ngh·ªâ ph√©p cho ng√†y ƒë√£ qua', 'error');
                        return;
                    }

                    if (toDateObj < fromDateObj) {
                        showNotification('Ng√†y k·∫øt th√∫c ph·∫£i sau ho·∫∑c b·∫±ng ng√†y b·∫Øt ƒë·∫ßu', 'error');
                        return;
                    }

                    // Check for overlapping requests
                    const hasOverlap = leaveRequests.some(req => {
                        if (req.employeeId !== formData.employeeId || req.status === 'rejected') {
                            return false;
                        }
                        
                        const reqFromDate = new Date(req.fromDate);
                        const reqToDate = new Date(req.toDate);
                        
                        return !(toDateObj < reqFromDate || fromDateObj > reqToDate);
                    });

                    if (hasOverlap) {
                        showNotification('Nh√¢n vi√™n n√†y ƒë√£ c√≥ ƒë∆°n ngh·ªâ ph√©p tr√πng th·ªùi gian', 'error');
                        return;
                    }

                    const employee = employees.find(e => e.id === formData.employeeId);
                    const department = departments.find(d => d.id === formData.departmentId);

                    const leaveDays = calculateLeaveDays(formData.fromDate, toDate, formData.leaveType, formData.startDayType, formData.endDayType);

                    const requestData = {
                        employeeId: formData.employeeId,
                        employeeName: employee?.name,
                        departmentId: formData.departmentId,
                        departmentName: department?.name,
                        fromDate: formData.fromDate,
                        toDate: toDate,
                        leaveType: formData.leaveType,
                        startDayType: formData.startDayType,
                        endDayType: formData.endDayType,
                        leaveDays: leaveDays,
                        reason: formData.reason,
                        customReason: formData.customReason,
                        location: formData.location,
                        status: 'pending'
                    };

                    setLoading(true);
                    await firebaseService.createLeaveRequest(requestData);
                    
                    // If real-time is not enabled, manually reload
                    if (!realtimeEnabled) {
                        const updatedRequests = await firebaseService.getLeaveRequests();
                        setLeaveRequests(updatedRequests);
                    }

                    showNotification('ƒêƒÉng k√Ω ngh·ªâ ph√©p th√†nh c√¥ng!');
                    
                    // Reset form
                    setFormData({
                        departmentId: '',
                        employeeId: '',
                        fromDate: '',
                        toDate: '',
                        leaveType: 'full-day',
                        startDayType: 'full-day',
                        endDayType: 'full-day',
                        reason: '',
                        customReason: '',
                        location: 'trong-tp'
                    });

                } catch (error) {
                    showNotification('L·ªói t·∫°o ƒë∆°n ngh·ªâ ph√©p: ' + error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleApproval = async (requestId, action) => {
                try {
                    setLoading(true);
                    await firebaseService.updateLeaveRequestStatus(requestId, action);
                    
                    // If real-time is not enabled, manually reload
                    if (!realtimeEnabled) {
                        const updatedRequests = await firebaseService.getLeaveRequests();
                        setLeaveRequests(updatedRequests);
                    }

                    showNotification(
                        action === 'approved' ? 'ƒê√£ duy·ªát ƒë∆°n ngh·ªâ ph√©p' : 'ƒê√£ t·ª´ ch·ªëi ƒë∆°n ngh·ªâ ph√©p'
                    );
                } catch (error) {
                    showNotification('L·ªói c·∫≠p nh·∫≠t tr·∫°ng th√°i: ' + error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const checkPassword = (password) => {
                if (password === '0309') {
                    setShowPasswordPrompt(false);
                    setCurrentPage('approval');
                } else {
                    showNotification('M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng', 'error');
                }
            };

            const getEmployeesForDepartment = (deptId) => {
                return employees.filter(emp => emp.departmentId === deptId);
            };
            const getReasonLabel = (reason, customReason) => {
                if (reason === 'khac') {
                    return customReason;
                }
                return reasonOptions.find(r => r.value === reason)?.label || reason;
            };

            const getLeaveTypeLabel = (leaveType) => {
                return leaveTypeOptions.find(t => t.value === leaveType)?.label || leaveType;
            };

            const getStartDayTypeLabel = (startDayType) => {
                return startDayTypeOptions.find(t => t.value === startDayType)?.label || startDayType;
            };

            const getEndDayTypeLabel = (endDayType) => {
                return endDayTypeOptions.find(t => t.value === endDayType)?.label || endDayType;
            };

            const formatDate = (dateString) => {
                if (!dateString) return 'N/A';
                const date = new Date(dateString);
                return date.toLocaleDateString('vi-VN');
            };

            const formatDateRange = (fromDate, toDate, leaveType, startDayType, endDayType, leaveDays) => {
                if (fromDate === toDate) {
                    const typeLabel = getLeaveTypeLabel(leaveType);
                    return `${formatDate(fromDate)} (${typeLabel})`;
                }
                
                let description = `${formatDate(fromDate)} - ${formatDate(toDate)}`;
                
                const startLabel = getStartDayTypeLabel(startDayType);
                const endLabel = getEndDayTypeLabel(endDayType);
                
                if (startDayType !== 'full-day' || endDayType !== 'full-day') {
                    description += ` (${startLabel}, ${endLabel})`;
                }
                
                description += ` - ${leaveDays} ng√†y`;
                
                return description;
            };

            const pendingRequests = leaveRequests.filter(req => req.status === 'pending');

            // Show Firebase error screen
            if (firebaseError && !isFirebaseReady) {
                return (
                    <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <div className="text-center">
                            <div style={{ fontSize: '48px', marginBottom: '16px' }}>üî•</div>
                            <h2 className="text-xl font-bold mb-4">L·ªói k·∫øt n·ªëi Firebase</h2>
                            <p className="text-gray-600 mb-4">{firebaseError}</p>
                            <div className="bg-gray-50 p-4 rounded-lg text-sm text-left mb-4">
                                <strong>H∆∞·ªõng d·∫´n kh·∫Øc ph·ª•c:</strong>
                                <ol style={{ marginLeft: '20px', marginTop: '8px' }}>
                                    <li>Ki·ªÉm tra firebaseConfig trong code</li>
                                    <li>ƒê·∫£m b·∫£o Firebase project ƒë√£ ƒë∆∞·ª£c t·∫°o</li>
                                    <li>Ki·ªÉm tra Firestore Rules</li>
                                    <li>Xem console ƒë·ªÉ bi·∫øt chi ti·∫øt l·ªói</li>
                                </ol>
                            </div>
                            <button
                                onClick={() => window.location.reload()}
                                className="btn btn-primary"
                            >
                                Th·ª≠ l·∫°i
                            </button>
                        </div>
                    </div>
                );
            }

            // Loading screen
            if (loading && departments.length === 0) {
                return (
                    <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <div className="text-center">
                            <div className="loading-spinner h-8" style={{ border: '3px solid #f3f3f3', borderTop: '3px solid #3b82f6', borderRadius: '50%', margin: '0 auto 16px' }}></div>
                            <p>ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Firebase...</p>
                            <p className="text-sm text-gray-500 mt-2">
                                {realtimeEnabled ? 'Real-time updates ƒë√£ b·∫≠t' : 'ƒêang thi·∫øt l·∫≠p k·∫øt n·ªëi...'}
                            </p>
                        </div>
                    </div>
                );
            }

            const HomePage = () => (
                <div className="container">
                    <div className="text-center mb-8">
                        <div className="header-brand">
                            <img src="logo.png" alt="Logo" className="brand-logo" />
                            <h1 className="text-3xl font-bold text-gray-800">
                                H·ªá th·ªëng Qu·∫£n l√Ω ngh·ªâ ph√©p Ph√≤ng H√†nh ch√≠nh
                            </h1>
                        </div>
                        <p className="text-gray-600">
                            ƒêƒÉng k√Ω v√† duy·ªát l·ªãch ngh·ªâ ph√©p tr·ª±c tuy·∫øn
                        </p>
                        <div className="flex flex-center mt-2">
                            <button
                                onClick={loadData}
                                className="btn btn-primary mr-2"
                                disabled={loading}
                            >
                                <span className={`loading-spinner mr-2 ${loading ? '' : 'hidden'}`} style={{ width: '16px', height: '16px', border: '2px solid transparent', borderTop: '2px solid white', borderRadius: '50%' }}></span>
                                L√†m m·ªõi d·ªØ li·ªáu
                            </button>
                            <div className="text-sm" style={{
                                color: realtimeEnabled ? '#10b981' : '#f59e0b',
                                display: 'flex',
                                alignItems: 'center'
                            }}>

                            </div>
                        </div>
                    </div>

                    <div className="grid grid-2">
                        <div className="card">
                            <div className="flex mb-4">
                                <span className="icon text-blue-500 mr-3" aria-hidden="true">‚ûï</span>
                                <h2 className="text-xl font-semibold">ƒêƒÉng k√Ω ngh·ªâ ph√©p</h2>
                            </div>
                            <p className="text-gray-600 mb-4">
                                T·∫°o ƒë∆°n xin ngh·ªâ ph√©p m·ªõi ƒë·ªÉ g·ª≠i cho tr∆∞·ªüng ph√≤ng duy·ªát
                            </p>
                            <button
                                onClick={() => setCurrentPage('request')}
                                className="btn btn-primary w-full"
                                disabled={loading}
                            >
                                T·∫°o ƒë∆°n ngh·ªâ ph√©p
                            </button>
                        </div>

                        <div className="card">
                            <div className="flex mb-4">
                                <span className="icon text-green-500 mr-3" aria-hidden="true">‚úì</span>
                                <h2 className="text-xl font-semibold">Duy·ªát l·ªãch ngh·ªâ ph√©p</h2>
                            </div>
                            <p className="text-gray-600 mb-4">
                                D√†nh cho tr∆∞·ªüng ph√≤ng ƒë·ªÉ xem v√† duy·ªát c√°c ƒë∆°n ngh·ªâ ph√©p
                            </p>
                            <button
                                onClick={() => setShowPasswordPrompt(true)}
                                className="btn btn-success w-full"
                                disabled={loading}
                            >
                                <span className="icon mr-2" aria-hidden="true">üîí</span>
                                V√†o trang duy·ªát
                            </button>
                            {pendingRequests.length > 0 && (
                                <div className="mt-2 text-sm text-orange-600 text-center">
                                    {pendingRequests.length} ƒë∆°n ch·ªù duy·ªát
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="card mt-8">
                        <div className="flex flex-between mb-4">
                            <h3 className="text-lg font-semibold">Th·ªëng k√™ t·ªïng quan</h3>
                            <div className="text-sm text-gray-500">
                                T·ªïng {departments.length} T·ªï, {employees.length} nh√¢n vi√™n
                            </div>
                        </div>
                        <div className="grid grid-4">
                            <div className="stat-card">
                                <div className="stat-number text-blue-500">
                                    {leaveRequests.length}
                                </div>
                                <div className="stat-label">T·ªïng ƒë∆°n</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-number text-orange-500">
                                    {pendingRequests.length}
                                </div>
                                <div className="stat-label">Ch·ªù duy·ªát</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-number text-green-500">
                                    {leaveRequests.filter(r => r.status === 'approved').length}
                                </div>
                                <div className="stat-label">ƒê√£ duy·ªát</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-number text-red-500">
                                    {leaveRequests.filter(r => r.status === 'rejected').length}
                                </div>
                                <div className="stat-label">T·ª´ ch·ªëi</div>
                            </div>
                        </div>
                    </div>

                    {/* Recent requests */}
                    {leaveRequests.length > 0 && (
                        <div className="card mt-8">
                            <h3 className="text-lg font-semibold mb-4">ƒê∆°n ngh·ªâ ph√©p g·∫ßn ƒë√¢y</h3>
                            <div className="space-y-2">
                                {leaveRequests.slice(0, 3).map(request => (
                                    <div 
                                        key={request.id} 
                                        className="border rounded-lg p-3 bg-gray-50 cursor-pointer hover:bg-gray-100"
                                        onClick={() => {
                                            setSelectedRequest(request);
                                            setShowRequestDetail(true);
                                        }}
                                        style={{ cursor: 'pointer' }}
                                    >
                                        <div className="flex flex-between">
                                            <div>
                                                <span className="font-medium">{request.employeeName}</span>
                                                <span className="text-sm text-gray-600 ml-2">
                                                    {formatDateRange(request.fromDate, request.toDate, request.leaveType, request.startDayType, request.endDayType, request.leaveDays)}
                                                </span>
                                            </div>
                                            <span className={`badge ${
                                                request.status === 'approved' ? 'success' : 
                                                request.status === 'rejected' ? 'danger' : 'warning'
                                            }`} style={{
                                                backgroundColor: request.status === 'pending' ? '#fef3c7' : undefined,
                                                color: request.status === 'pending' ? '#92400e' : undefined
                                            }}>
                                                {request.status === 'approved' ? 'ƒê√£ duy·ªát' : 
                                                request.status === 'rejected' ? 'ƒê√£ t·ª´ ch·ªëi' : 'Ch·ªù duy·ªát'}
                                            </span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );

            const RequestFormPage = () => (
                <div className="container-sm">
                    <div className="card">
                        <h2 className="text-2xl font-bold mb-6 flex">
                            <span className="icon mr-2" aria-hidden="true">üìÑ</span>
                            ƒêƒÉng k√Ω ngh·ªâ ph√©p
                        </h2>

                        <div className="space-y-4">
                            <div>
                                <label className="label">
                                    T·ªï c√¥ng t√°c *
                                </label>
                                <select
                                    value={formData.departmentId}
                                    onChange={(e) => setFormData({
                                        ...formData,
                                        departmentId: e.target.value,
                                        employeeId: ''
                                    })}
                                    className="input"
                                    required
                                    disabled={loading}
                                >
                                    <option value="">-- Ch·ªçn t·ªï c√¥ng t√°c --</option>
                                    {departments.map(dept => (
                                        <option key={dept.id} value={dept.id}>
                                            {dept.name}
                                        </option>
                                    ))}
                                </select>
                            </div>

                            {formData.departmentId && (
                                <div>
                                    <label className="label">
                                        Nh√¢n vi√™n *
                                    </label>
                                    <select
                                        value={formData.employeeId}
                                        onChange={(e) => setFormData({
                                            ...formData,
                                            employeeId: e.target.value
                                        })}
                                        className="input"
                                        required
                                        disabled={loading}
                                    >
                                        <option value="">-- Ch·ªçn nh√¢n vi√™n --</option>
                                        {getEmployeesForDepartment(formData.departmentId).map(emp => (
                                            <option key={emp.id} value={emp.id}>
                                                {emp.name}
                                            </option>
                                        ))}
                                    </select>
                                </div>
                            )}

                            <div className="form-row">
                                <div>
                                    <label className="label">
                                        T·ª´ ng√†y *
                                    </label>
                                    <input
                                        type="date"
                                        value={formData.fromDate}
                                        onChange={(e) => setFormData({
                                            ...formData,
                                            fromDate: e.target.value
                                        })}
                                        className="input"
                                        required
                                        disabled={loading}
                                    />
                                </div>
                                <div>
                                    <label className="label">
                                        ƒê·∫øn ng√†y
                                    </label>
                                    <input
                                        type="date"
                                        value={formData.toDate}
                                        onChange={(e) => setFormData({
                                            ...formData,
                                            toDate: e.target.value
                                        })}
                                        min={formData.fromDate}
                                        className="input"
                                        disabled={loading}
                                    />
                                    <p className="text-xs text-gray-500 mt-1">
                                        ƒê·ªÉ tr·ªëng n·∫øu ch·ªâ ngh·ªâ 1 ng√†y
                                    </p>
                                </div>
                            </div>

                            {(!formData.toDate || formData.fromDate === formData.toDate) && (
                                <div>
                                    <label className="label">
                                        Lo·∫°i ngh·ªâ ph√©p *
                                    </label>
                                    <div className="radio-group">
                                        {leaveTypeOptions.map(option => (
                                            <label key={option.value} className="radio-item">
                                                <input
                                                    type="radio"
                                                    name="leaveType"
                                                    value={option.value}
                                                    checked={formData.leaveType === option.value}
                                                    onChange={(e) => setFormData({
                                                        ...formData,
                                                        leaveType: e.target.value
                                                    })}
                                                    required
                                                    disabled={loading}
                                                />
                                                {option.label}
                                            </label>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {formData.toDate && formData.fromDate !== formData.toDate && (
                                <div className="form-row">
                                    <div>
                                        <label className="label">
                                            Ng√†y b·∫Øt ƒë·∫ßu ngh·ªâ *
                                        </label>
                                        <div className="radio-group">
                                            {startDayTypeOptions.map(option => (
                                                <label key={option.value} className="radio-item">
                                                    <input
                                                        type="radio"
                                                        name="startDayType"
                                                        value={option.value}
                                                        checked={formData.startDayType === option.value}
                                                        onChange={(e) => setFormData({
                                                            ...formData,
                                                            startDayType: e.target.value
                                                        })}
                                                        required
                                                        disabled={loading}
                                                    />
                                                    {option.label}
                                                </label>
                                            ))}
                                        </div>
                                    </div>
                                    <div>
                                        <label className="label">
                                            Ng√†y k·∫øt th√∫c ngh·ªâ *
                                        </label>
                                        <div className="radio-group">
                                            {endDayTypeOptions.map(option => (
                                                <label key={option.value} className="radio-item">
                                                    <input
                                                        type="radio"
                                                        name="endDayType"
                                                        value={option.value}
                                                        checked={formData.endDayType === option.value}
                                                        onChange={(e) => setFormData({
                                                            ...formData,
                                                            endDayType: e.target.value
                                                        })}
                                                        required
                                                        disabled={loading}
                                                    />
                                                    {option.label}
                                                </label>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div>
                                <label className="label">
                                    L√Ω do ngh·ªâ ph√©p *
                                </label>
                                <div className="radio-group">
                                    {reasonOptions.map(option => (
                                        <label key={option.value} className="radio-item">
                                            <input
                                                type="radio"
                                                name="reason"
                                                value={option.value}
                                                checked={formData.reason === option.value}
                                                onChange={(e) => setFormData({
                                                    ...formData,
                                                    reason: e.target.value,
                                                    customReason: e.target.value !== 'khac' ? '' : formData.customReason
                                                })}
                                                required
                                                disabled={loading}
                                            />
                                            {option.label}
                                        </label>
                                    ))}
                                </div>
                            </div>
                            <div>
                                <label className="label">
                                    ƒê·ªãa ƒëi·ªÉm ngh·ªâ ph√©p *
                                </label>
                                <div className="radio-group">
                                    {locationOptions.map(option => (
                                        <label key={option.value} className="radio-item">
                                            <input
                                                type="radio"
                                                name="location"
                                                value={option.value}
                                                checked={formData.location === option.value}
                                                onChange={(e) => setFormData({
                                                    ...formData,
                                                    location: e.target.value
                                                })}
                                                required
                                                disabled={loading}
                                            />
                                            {option.label}
                                        </label>
                                    ))}
                                </div>
                            </div>

                            {formData.reason === 'khac' && (
                                <div>
                                    <label className="label">
                                        L√Ω do c·ª• th·ªÉ *
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.customReason}
                                        onChange={(e) => setFormData({
                                            ...formData,
                                            customReason: e.target.value
                                        })}
                                        placeholder="Nh·∫≠p l√Ω do c·ª• th·ªÉ..."
                                        className="input"
                                        required
                                        disabled={loading}
                                    />
                                </div>
                            )}

                            {formData.fromDate && (
                                <div className="form-summary">
                                    <h4 className="font-medium mb-2">T√≥m t·∫Øt ƒë∆°n ngh·ªâ ph√©p:</h4>
                                    <p className="text-sm">
                                        <span className="font-medium">Th·ªùi gian:</span> {formatDateRange(
                                            formData.fromDate, 
                                            formData.toDate || formData.fromDate, 
                                            formData.leaveType,
                                            formData.startDayType,
                                            formData.endDayType,
                                            calculateLeaveDays(formData.fromDate, formData.toDate || formData.fromDate, formData.leaveType, formData.startDayType, formData.endDayType)
                                        )}
                                    </p>
                                    <p className="text-sm">
                                        <span className="font-medium">S·ªë ng√†y ngh·ªâ:</span> {calculateLeaveDays(
                                            formData.fromDate, 
                                            formData.toDate || formData.fromDate, 
                                            formData.leaveType,
                                            formData.startDayType,
                                            formData.endDayType
                                        )} ng√†y
                                    </p>
                                </div>
                            )}

                            <div className="flex space-x-4 pt-4 flex-mobile mobile-sticky-actions">
                                <button
                                    type="button"
                                    onClick={() => setCurrentPage('home')}
                                    className="btn btn-secondary flex-1"
                                    disabled={loading}
                                >
                                    Quay l·∫°i
                                </button>
                                <button
                                    type="button"
                                    onClick={handleFormSubmit}
                                    className="btn btn-primary flex-1"
                                    disabled={loading}
                                >
                                    {loading ? (
                                        <>
                                            <span className="loading-spinner mr-2" style={{ width: '16px', height: '16px', border: '2px solid transparent', borderTop: '2px solid white', borderRadius: '50%' }}></span>
                                            ƒêang g·ª≠i...
                                        </>
                                    ) : (
                                        'G·ª≠i ƒë∆°n'
                                    )}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            const ApprovalPage = () => (
                <div className="container">
                    <div className="card">
                        <div className="flex flex-between mb-6">
                            <h2 className="text-2xl font-bold flex">
                                <span className="icon text-green-500 mr-2" aria-hidden="true">‚úì</span>
                                Duy·ªát l·ªãch ngh·ªâ ph√©p
                            </h2>
                            <div className="flex space-x-2 mobile-stack">
                                <button
                                    onClick={loadData}
                                    className="btn btn-primary"
                                    disabled={loading}
                                >
                                    <span className={`loading-spinner mr-2 ${loading ? '' : 'hidden'}`} style={{ width: '16px', height: '16px', border: '2px solid transparent', borderTop: '2px solid white', borderRadius: '50%' }}></span>
                                    L√†m m·ªõi
                                </button>
                                <button
                                    onClick={() => setCurrentPage('home')}
                                    className="btn btn-secondary"
                                    disabled={loading}
                                >
                                    V·ªÅ trang ch·ªß
                                </button>
                            </div>
                        </div>

                        {pendingRequests.length === 0 ? (
                            <div className="empty-state">
                                <span className="h-12" style={{ fontSize: '48px' }}>‚è∞</span>
                                <p>Kh√¥ng c√≥ ƒë∆°n ngh·ªâ ph√©p n√†o ch·ªù duy·ªát</p>
                                {leaveRequests.length > 0 && (
                                    <p className="text-sm text-gray-500 mt-2">
                                        T·ªïng c·ªông ƒë√£ x·ª≠ l√Ω {leaveRequests.length} ƒë∆°n ngh·ªâ ph√©p
                                    </p>
                                )}
                            </div>
                        ) : (
                            <div className="space-y-4">
                                <div className="text-sm text-gray-600 mb-4">
                                    C√≥ {pendingRequests.length} ƒë∆°n ngh·ªâ ph√©p ch·ªù duy·ªát
                                </div>
                                {pendingRequests.map(request => (
                                    <div key={request.id} className="border rounded-lg p-4 card">
                                        <div className="flex flex-between">
                                            <div className="flex-1">
                                                <div className="form-row">
                                                    <div>
                                                        <h3 className="font-semibold text-lg">{request.employeeName}</h3>
                                                        <p className="text-sm text-gray-600">{request.departmentName}</p>
                                                    </div>
                                                    <div>
                                                        <p><span className="font-medium">Th·ªùi gian ngh·ªâ:</span> {formatDateRange(request.fromDate, request.toDate, request.leaveType, request.startDayType, request.endDayType, request.leaveDays)}</p>
                                                        <p><span className="font-medium">S·ªë ng√†y:</span> {request.leaveDays} ng√†y</p>
                                                        <p><span className="font-medium">L√Ω do:</span> {getReasonLabel(request.reason, request.customReason)}</p>
                                                        <p className="text-sm text-gray-500">ƒêƒÉng k√Ω: {formatDate(request.requestDate)}</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="flex space-x-2 ml-4 mobile-stack">
                                                <button
                                                    onClick={() => handleApproval(request.id, 'approved')}
                                                    className="btn btn-success"
                                                    disabled={loading}
                                                >
                                                    Duy·ªát
                                                </button>
                                                <button
                                                    onClick={() => handleApproval(request.id, 'rejected')}
                                                    className="btn btn-danger"
                                                    disabled={loading}
                                                >
                                                    T·ª´ ch·ªëi
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {leaveRequests.length > pendingRequests.length && (
                            <div className="mt-8">
                                <h3 className="text-lg font-semibold mb-4">L·ªãch s·ª≠ c√°c ƒë∆°n ƒë√£ x·ª≠ l√Ω</h3>
                                <div className="space-y-2">
                                    {leaveRequests
                                        .filter(req => req.status !== 'pending')
                                        .slice(0, 10)
                                        .map(request => (
                                        <div key={request.id} className="border rounded-lg p-3 bg-gray-50">
                                            <div className="flex flex-between">
                                                <div>
                                                    <span className="font-medium">{request.employeeName}</span>
                                                    <span className="text-sm text-gray-600 ml-2">
                                                        {formatDateRange(request.fromDate, request.toDate, request.leaveType, request.startDayType, request.endDayType, request.leaveDays)}
                                                    </span>
                                                </div>
                                                <div className="flex space-x-2">
                                                    <span className={`badge ${
                                                        request.status === 'approved' ? 'success' : 'danger'
                                                    }`}>
                                                        {request.status === 'approved' ? 'ƒê√£ duy·ªát' : 'ƒê√£ t·ª´ ch·ªëi'}
                                                    </span>
                                                    {request.approvedDate && (
                                                        <span className="text-xs text-gray-500">
                                                            {formatDate(request.approvedDate)}
                                                        </span>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                {leaveRequests.filter(req => req.status !== 'pending').length > 10 && (
                                    <div className="text-center text-sm text-gray-500 mt-4">
                                        Ch·ªâ hi·ªÉn th·ªã 10 ƒë∆°n g·∫ßn nh·∫•t. T·ªïng c·ªông ƒë√£ x·ª≠ l√Ω {leaveRequests.filter(req => req.status !== 'pending').length} ƒë∆°n.
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );

            const PasswordPrompt = () => {
                const [password, setPassword] = useState('');

                const handleSubmit = () => {
                    checkPassword(password);
                    setPassword('');
                };

                const handleKeyPress = (e) => {
                    if (e.key === 'Enter') {
                        handleSubmit();
                    }
                };

                return (
                    <div className="modal-overlay">
                        <div className="modal">
                            <h3 className="text-lg font-semibold mb-4 flex">
                                <span className="icon mr-2" aria-hidden="true">üîí</span>
                                X√°c th·ª±c tr∆∞·ªüng ph√≤ng
                            </h3>
                            <div>
                                <div className="mb-4">
                                    <label className="label">
                                        M·∫≠t kh·∫©u (4 s·ªë)
                                    </label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        onKeyPress={handleKeyPress}
                                        placeholder="Nh·∫≠p m·∫≠t kh·∫©u..."
                                        className="input"
                                        maxLength="4"
                                        disabled={loading}
                                        autoFocus
                                    />
                                    <p className="text-xs text-gray-500 mt-1"></p>
                                </div>
                                <div className="flex space-x-2">
                                    <button
                                        type="button"
                                        onClick={() => {
                                            setShowPasswordPrompt(false);
                                            setPassword('');
                                        }}
                                        className="btn btn-secondary flex-1"
                                        disabled={loading}
                                    >
                                        H·ªßy
                                    </button>
                                    <button
                                        type="button"
                                        onClick={handleSubmit}
                                        className="btn btn-primary flex-1"
                                        disabled={loading}
                                    >
                                        X√°c nh·∫≠n
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div style={{ minHeight: '100dvh' }}>
                    {currentPage === 'home' && <HomePage />}
                    {currentPage === 'request' && <RequestFormPage />}
                    {currentPage === 'approval' && <ApprovalPage />}
                    {showPasswordPrompt && <PasswordPrompt />}
                    {showRequestDetail && (
                        <RequestDetailModal 
                            request={selectedRequest}
                            onClose={() => {
                                setShowRequestDetail(false);
                                setSelectedRequest(null);
                            }}
                            onApproval={currentPage === 'approval' ? handleApproval : null}
                            loading={loading}
                        />
                    )}
                </div>
            );
        };
        

        const root = ReactDOM.createRoot(document.getElementById('app'));
        root.render(<LeaveManagementApp />);
    </script>
</body>
</html>
